<!doctype html>

<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>HPWH analysis</title>

	<style>
		body {
			font-family: Arial;
		}

		.collapsible {
			background-color: #777;
			color: white;
			cursor: pointer;
			padding: 18px;
			width: 100%;
			border: none;
			text-align: left;
			outline: none;
			font-size: 15px;
		}

		.active,
		.collapsible:hover {
			background-color: #555;
		}

		.content {
			padding: 0 18px;
			max-height: 0;
			overflow: hidden;
			transition: max-height 0.2s ease-out;
			background-color: #f1f1f1;
		}
	</style>

</head>

<script>
	async function callPyServer(cmd, fst) {
		await fetch('http://localhost:8000/' + cmd + '?' + fst);
	}

	async function callPyServerJSON(cmd, fst) {
		const response = await fetch('http://localhost:8000/' + cmd + '?' + fst);
		data = await response.json();
		return data;
	}

	let ws_connection = null;
	async function init_websocket() {

		await callPyServer("launch_ws", "")

		ws_connection = await new WebSocket("ws://localhost:8600");
		ws_connection.addEventListener("message", (msg) => {
				if ('data' in msg)
				{
					console.log(msg['data'])
				
				}
			});
	}

	async function send_to_ws()
	{
		await ws_connection.send("from index.html");
	}

	async function launch_dash() {

			data = {
			'label': 'none'
			};
		await callPyServer("launch_perf_proc",  "data=" + JSON.stringify(data))

		document.getElementById("perf_plot").src = "http://localhost:8051"
		document.getElementById("perf_plot").style = "display:block;"
	}
</script>

<body>

<!-- content -->
<button type="button" id="send_to_ws" onclick="send_to_ws();">send to ws</button>

<button type="button" id="launch_dash" onclick="launch_dash();">launch dash</button>

<div id="perf_plot_div">
		<iframe title="perf_plot" src="" id="perf_plot" width=1200 height=1200 style="display:none;"></iframe>
</div>

</body>

<script>
	init_websocket().then({}, {})
</script>

</html>