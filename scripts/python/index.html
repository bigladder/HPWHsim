<!doctype html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>HPWH analysis</title>

<style>
body {font-family: Arial;}

.collapsible {
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.active, .collapsible:hover {
  background-color: #555;
}

.content {
  padding: 0 18px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
  background-color: #f1f1f1;
}
</style>

</head>

<body>

<form id="modelForm">
    <label for="model_arg1">model spec:</label>
    <input type="text" id="model_arg1" name="model_arg1" required><br><br>

    <label for="model_arg2">model name:</label>
    <input type="text" id="model_arg2" name="model_arg2" required><br><br>
</form>

<script>
  const model_form = document.getElementById('modelForm');
  model_form.model_arg1.value = "File";
  model_form.model_arg2.value = "AquaThermAire";
</script>

<script>
  async function plot() {
    const model_form = document.getElementById('modelForm');
    const farg1 = model_form.model_arg1.value;
    const farg2 = model_form.model_arg2.value;

    const plot_form = document.getElementById('plotForm');
    const farg3 = plot_form.plot_arg1.value;
    const farg4 = plot_form.plot_arg2.value;
    const farg5 = plot_form.plot_arg3.value;

    fst = 'arg1=' + farg1;
    fst += '&arg2=' + farg2;
    fst += '&arg3=' + farg3;
    fst += '&arg4=' + farg4;
    fst += '&arg5=' + farg5;

    document.getElementById("plot_btn").disabled = true;

	  const response = await fetch('http://localhost:8000/test_and_plot?' + fst,
		{
			method: 'GET'
		}
	  );

    const data = await response.json();
    const energy_data = data["energy_data"];

    measE = energy_data["measuredE_Wh"].toFixed(2);
    simE = energy_data["simulatedE_Wh"].toFixed(2);
    document.getElementById("energy_measured").innerHTML = "Measured energy consumption (Wh): " + measE;
    document.getElementById("energy_simulated").innerHTML = "Simulated energy consumption (Wh): " + simE;

    model_form.model_arg1.value = farg1;
    model_form.model_arg2.value = farg2;

    document.getElementById("model_arg1").value = farg1; 
    document.getElementById("model_arg2").value = farg2; 
 
    document.getElementById("model_arg1").defaultValue = farg1; 
    document.getElementById("model_arg2").defaultValue = farg2; 

    document.getElementById("plot_arg1").value = farg3; 
    document.getElementById("plot_arg2").value = farg4; 
    document.getElementById("plot_arg3").value = farg5; 

    document.getElementById("plot_arg1").defaultValue = farg3; 
    document.getElementById("plot_arg2").defaultValue = farg4; 
    document.getElementById("plot_arg3").defaultValue = farg5; 

    localStorage.setItem("plot_arg1", farg3);
    localStorage.setItem("plot_arg2", farg4);
    localStorage.setItem("plot_arg3", farg5);

    document.getElementById("plots").src = "../../build/test/output/" + farg4
    document.getElementById("plots").style = "display:block;"
  
    document.getElementById("plot_btn").disabled = false;
  }

  async function measure() {
    const model_form = document.getElementById('modelForm');
    const farg1 = model_form.model_arg1.value;
    const farg2 = model_form.model_arg2.value;

    fst = 'arg1=' + farg1;
    fst += '&arg2=' + farg2;

    document.getElementById("measure_btn").disabled = true;

    const response = await fetch('http://localhost:8000/measure?' + fst, { signal: AbortSignal.timeout(5000) })

    model_form.model_arg1.value = farg1;
    model_form.model_arg2.value = farg2;

    document.getElementById("model_arg1").value = farg1; 
    document.getElementById("model_arg2").value = farg2; 
 
    document.getElementById("model_arg1").defaultValue = farg1; 
    document.getElementById("model_arg2").defaultValue = farg2; 

    document.getElementById("results").style="display:block;"
    document.getElementById("results").data = "";
    document.getElementById("results").data = "../../build/test/output/results.txt";

    document.getElementById("measure_btn").disabled = false;
  }
</script>


<!-- content -->
<button id="plot_tab" class="collapsible">Plot</button>
<div class="content">
  <form id="plotForm">
      <label for="plot_arg1">test name:</label>
      <input type="text" id="plot_arg1" name="plot_arg1" required><br><br>

      <label for="plot_arg2">plot name:</label>
      <input type="text" id="plot_arg2" name="plot_arg2" required><br><br>

      <label for="plot_arg3">measurements name:</label>
      <input type="text" id="plot_arg3" name="plot_arg3" required><br><br>

      <button type="button" id="plot_btn" onclick="plot();">plot</button>
  </form>

  <iframe title="Plots" src="" id="plots" width=1200 height=800 style="display:none;"></iframe>

  <p id="energy_measured"></p>
  <p id="energy_simulated"></p> 

 </div>

<!-- content -->
<button id="measure_tab" class="collapsible">Measure</button>
<div class="content">
  <button type="button" id="measure_btn" onclick="measure();">measure</button>
  <object id="results" data="../../build/test/output/results.txt" width=800 height=800 style="display:none;"></object>
</div>

<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.maxHeight){
      content.style.maxHeight = null;
    } else {
      if(this.id == "plot_tab")
        content.style.maxHeight = "1020px";
      else if(this.id == "measure_tab")
        content.style.maxHeight = "320px";
    } 
  });
}
</script>

</body>

<script>
  const plot_form = document.getElementById('plotForm');
  plot_form.plot_arg1.value = "villara_24hr67";
  plot_form.plot_arg2.value = "plot.html"
  plot_form.plot_arg3.value = "measured.csv";

  //var plot_btn = document.getElementById("plot_btn");

</script>

</html>